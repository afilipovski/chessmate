# Вовед

Ние одлучивме да ја развиеме познатата игра шах како Windows Forms апликација со вештачка интелигенција (Alpha-Beta Pruning алгоритмот). Играчот со неговите бели фигури се натпреварува против црните фигури на вештачката интелигенција и победникот е тој што успешно ќе го фати кралот на другиот.

# Како се користи?

По стартување на апликацијата се уклучува формата Form1 со шаховската табла. На долниот дел од таблата се дадени белите фигури, а на горниот црните. 
Над црните фигури се наоѓа мени со 3 табови: File, Opponent и About. Во табот Opponent играчот ја бира тежината на играта (Easy, Medium, Hard). Со кликање на табот About се отвара нова форма на којашто се прикажани имињата на членовите на тимот. Во File табот постојат следните опции:
- New: Започнување нова игра.
- Open: Вчитување на постоечка игра од доклумент.
- Save: Зачувување на играта во веќе отворен документ.
- Save as: Зачувување на играта во нов документ.
- Exit: Излегување од апликацијата.

Играчот ги управува белите фигури, а вештачката интелигенција црните. Прв започнува играчот, па вештачката интелигенција. Кога играчот стиска на една од неговите фигури, апликацијата ги одредува и означува со зелена боја сите позиции кадешто одбраната фигура може да застане. Правилата за валидни позиции на секоја фигура се исти како тие од обичниот шах.

# Опис на техничкото решение
Имплементацијата на проектот се состои од користење разни класи, објекти и слики.

Во папката Pieces се наоѓаат класи за сите можни фигури на играта (Pawn, Knight, Bishop, Rook, King, Queen). Сите класи наследуваат од апстрактната класа Piece и ги имплементираат нејзините апстрактни методи (PossibleMoves, GetBitmap, Clone). Специјален случај е класата ContinuousPathPiece, која наследува од Piece и е наследена од Rook, Bishop и Queen. 

Визуелниот изглед на секоја фигура е даден во папката PieceImages. Апстрактниот метод GetBitmap на секоја фигура е задолжен за избирање на соодветната слика.

Кодот за вештачката имплементација стои во папката AlphaBeta. Класата Opponent ја симулира вештачката интелигенција, давајќи потези преку методот Move, кој ги повикува статичките методи од EvaluationUtils.   

Папката Interface содржи класи за работење со исцртување на фигури и прикажување пораки на екранот.

Класата Position се користи за означување на позиција од шаховкста табла со X и Y координата (двете меѓу 0 и 7). Оските се исти како тие во Windows Forms. Изведената класа GreenPosition служи за означување на постоечка позиција како зелена при означување на дозволени позиции на одбрана фигура.

Класата Board ја претставува шаховската табла. Секоја позиција, како и соодветната фигура на таа позција, се чува во хеш табела. Според потребите на вештачката интелигенција, секогаш кога се генерира нов валиден потег на фигура, тој потег ќе претставува нова табла што е deep copy на претходната (вклучувајќи ги сите фигури и позиции). Долниот код ги илустрира опишаните концепти за таблата. Така, вештачката интелигенција врши гранење на секој можен потег (до максимално дозволената длабочина на дрвото) и според оценувањата го бира најдобриот. Дополнително, класата Board содржи и методи за означување на новата позиција на мрдната фигура (NewPos), метод за генерирање на сите нови можни потези (Successor) и метод за одредување дали кралот е под ризик да биде фатен во една од новите позици (KingIsInCheck).

```c#
public class Board
{
  public Dictionary<Position, Piece> PieceByPosition { get; set; }
  public GreenPosition NewPos { get; set; }

  public Board(Board board)
  {
		PieceByPosition = new Dictionary<Position, Piece>();
		WhiteTurn = !board.WhiteTurn;
		foreach (Position key in board.PieceByPosition.Keys)
		{
			if (board.PieceByPosition[key] != null)
				PieceByPosition[key] = board.PieceByPosition[key].Clone();
			else
				PieceByPosition[key] = null;
		}
		TurnNumber = board.TurnNumber + 1;
	}

  public Board(Board b, Position posOld, Position posNew, Piece p) : this(b)
  {
		p = p.Clone();
		NewPos = new GreenPosition(posNew);
		PieceByPosition[posNew] = p;
		PieceByPosition[posOld] = null;
		PieceByPosition[posNew].Position = posNew;
  }
}
```
Класата Form1.cs го содржи кодот на формата Form1. Содржи методи за справување со настани за кликање на различни елементи и настани за исцртување на шаховската табла. За да се овозможи зачувување на состојбата на моменталната игра, сите корисничко дефинирани класи како Piece, Board и Position се декларирани за серијализација со анотацијата Serializable.

# Опис на класата Queen

Во продолжените е даден краток опис на класата Queen. Кралицата наследува од класата ContionuousPathPiece и имплементира сопствен конструктор и методите Clone, GetBitMap и PossibleMoves. Со оглед на тоа што кралицата ги имат истите потези на топот и лоцецот, во методот PossibleMoves кралицата преку copy конструктор се претвара во Bishop и Rook објекти. После, овие објекти се заменуваат во предадениот Board објект на местото на кралицата и се повикува PossibleMoves методот на двата објекти. За секоја нова создадена шаховска табела, на позицијата кадешто би застанала мрднатата фигура се става deep copy од кралицата. Сите нови шаховски табли се додаваат во листата што ја враќа методот.
